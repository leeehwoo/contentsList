<!DOCTYPE html>

<html lang="en">
   <head>
      <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
      <meta http-equiv="Pragma" content="no-cache">
      <meta charset="UTF-8">
      <title>STUDIO LIST TIANYAN REAL</title>
      <script type="text/javascript" src="https://code.jquery.com/jquery-latest.min.js"></script>
      <script type="text/javascript" src="/static/jquery.qrcode.js"></script>
      <script type="text/javascript" src="/static/qrcode.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
      <style>

        *{margin: 0; padding: 0; box-sizing: border-box;}
        li , ul {list-style: none;}

        .menu {display: flex; width: 100%; align-items: center; flex-wrap: wrap; background-color: #333;}
        .menu li {text-align: center; color: #fff; border-left: 1px solid #f5f5f5; line-height: 50px; width: calc(100% / 10); height: 50px; cursor: pointer; background-color: #333 ;}
        .menu li:first-child {border: 0;}
        .list {display: flex; align-items: center; flex-wrap: wrap; padding: 50px 100px; border-bottom: 2px dashed #999;}

        .list li {width: 12%; margin: 0 4%; height: 300px; }
        .list li > h3 {font-size: 18px; font-weight: bold;}
        .list li .list_box {background-color: #999; height: 230px; border-radius: 15px; overflow: hidden; cursor: pointer;}
        .list li .list_box img {width: 100%; height: 80%;}
        .list li .list_box h3 {text-align: center; height: 20%; display: flex; align-items: center; justify-content: center; font-size: 18px; color: #fff; background-color: #333;}
        .modal h3 {font-size: 12px}
        .qrcode2 {width: 100px; height: 100px;}
        .modal-json {padding: 10px; margin-top: 10px; border-top: 1px solid #ccc; font-size: 12px;}
      </style>
   </head>

   <body>
   <!-- <h1>Studio List(SODA BETA)</h1> -->
   <div>
       <!-- <br> -->
<body>
        <div id="wrap">
        <ul class="menu">
           <li>HOT</li>
           <li>NEW</li>
           <li>Personal Color</li>
           <li>ğŸ’«GlitterğŸ’«</li>
           <li>Mood</li>
           <li>Retro</li>
           <li>Cute</li>
           <li>ğŸ’„Makeup</li>
        </ul>
        <main>
            <ul class="list">
                <li class="box box${e.id}">
                    <h3 class="m_chk" data-toggle="modal" data-target="#exampleModal">${e.id}</h3>
                    <div class="m_chk list_box" data-toggle="modal" data-target="#exampleModal">
                        <img src="" alt="">
                        <h3>${e.title}</h3>
                    </div>
                </li>
            </ul>
        </main>
    </div>
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">studio information</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <h3>id:</h3>
              <h3>name:</h3>
              <h3>scheme:</h3>
              <div class="qrcode2"></div>
            </div>
            <div class="modal-json"></div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              <button type="button" class="dl btn btn-primary">QR download</button>
              <button type="button" class="json btn btn-primary">json</button>
            </div>
          </div>
        </div>
      </div>

   </body>
</body>

       <br>
       <br>
       <!-- <select id="select_app_type">
           <option value="soda_real" selected>soda real</option>
           <option value="soda_beta">soda beta</option>
           <option value="tianyan_real">tianyan real</option>
           <option value="tianyan_beta">tainyan beta</option>
       </select> -->
       <br>
       <br>
   </div>
      <div class="content-main">

        </div>
<!-- Bootstrapì˜ JavaScript ëª¨ë‹¬ í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•˜ì—¬ íŒì—…ì°½ì„ ë§Œë“ ë‹¤.
https://getbootstrap.com/docs/4.0/components/modal/ ì˜ ì˜ˆì œì†ŒìŠ¤ì½”ë“œ ì°¸ê³  -->


    <script>
// <!-- const {info} ë¥¼ ì‚¬ìš©, main_urlì„ style_infoë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.-->
        const studio_infos = {
            main_url:"tianyan://studio?",
            app_type:"tianyan_real",
        }
        const studio_json_info = {

        }

// <!--ajax_.pyì˜ call style api -->
    </script>
<script>
    var num = '';





// appendë¥¼ í•´ì£¼ëŠ” ë¶€ë¶„.(jQuery append with api call)
// ì•„ë˜ì˜ ë¶€ë¶„ì€ ê²°ê³¼ ì„±ê³µ call back í•¨ìˆ˜ì¸ë°, requestê°€ ì™„ë£Œë˜ì—ˆì„ ë•Œ, ì‹œì‘í•˜ëŠ” ë¶€ë¶„ì´ë‹¤.

function call_studio_api() {

    $.ajax({
        url: "/ajax/api/studio?appType=tianyan_real",
        success: function (result) {
            const r = result.result
            html = '';
            console.log(r)
            console.log(r.templates)
            r.templates.forEach(e => {
                html += `
                <li >
                    <h3>${e.id}</h3>
                    <div class="list_box">
                        <img src="${r.cdnPrefix+e.thumbnail}" alt="">
                        <h3>${e.title}</h3>
                    </div>
                </li>
                `
            });

            $(".list").html(html);
        },
        error: function (e) {
            console.error(e);
        }
    })
}

    var num = '';
    $(function (){


        call_studio_api();
        var num2 = ""
        // $(".modal").show();
        $(document) // apiê°€ ë¡œë”©ì´ ë˜ë©´
        .on("click", ".menu li" , function(){
            const t = $(this).text()
            $(".box").hide();
            for (let i = 0; i < arr_cat.length; i++) {
                if(arr_cat[i].title == t){
                    console.log(arr_cat[i].templateIds);
                    arr_cat[i].templateIds.forEach(e => {
                        $(".box"+e).show();
                        console.log(".box"+e);
                    });
                }

            }
        })
        .on("click", ".modal" , function(){
            // $(".modal").show();
        })
        .on("click", ".cl" , function (){
            $("canvas").remove(); // popup closeí–ˆì„ ë•Œ ì´ˆê¸°í™”ë˜ë„ë¡ í•œë‹¤. canvas(íì•Œì½”ë“œ) ì‚­ì œ
        })

           // ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ í´ë¦­
        .on("click", ".dl", function (e){

            // canvas ì§€ì •
            var can = $("canvas")[0];
            // ì´ë¯¸ì§€ ë§í¬ PNGë¡œ ìƒì„±
            var QR = can.toDataURL('image/png');
            // aTag ìƒì„±
            var aTag = document.createElement("a");
            console.log(num2);
           // ë‹¤ìš´ë¡œë“œì‹œ ì´ë¦„
            aTag.download = num2+'.png'
            // ìœ„ì— ë§í¬ ìƒì„±í•´ì¤€ê±¸ ë“±ë¡
            aTag.href = QR
            // aTagì„ í´ë¦­í•˜ì—¬ ë‹¤ìš´ë¡œë“œ
            aTag.click();
        })// í‚¤ë³´ë“œ esc ë²„íŠ¼ ëˆŒë €ì„ ë•Œ ì´ˆê¸°
        .keyup(function (e){
            if(e.keyCode == 27){
                $("canvas").remove();
            }
            console.log(e.keyCode);
        })
        .on("click" , ".m_ckh", function(){
            a = $(this).parent().data("id")
            aa = arr_tem[a];
            link = "tianyan://studio?templateId="+aa.id;
            html = `
                <h3>id:${aa.id}</h3>
              <h3>name:${aa.name}</h3>
              <h3>scheme:${link}</h3>
              <div class="qrcode2"></div>
            `;
            $(".modal-body").html(html);
            $(".modal-json").hide();
            console.log(aa);
            html2 =`{
                <br>
                &nbsp;contentType: ${aa.contentType}<br>
                &nbsp;createCount: ${aa.createCount}<br>
                &nbsp;id: ${aa.id}<br>
                &nbsp;likeCount: ${aa.likeCount}<br>
                &nbsp;link: ${aa.link}<br>
                &nbsp;name: ${aa.name}<br>
                &nbsp;nickname: ${aa.nickname}<br>
                &nbsp;thumbnail: ${aa.thumbnail}<br>
                &nbsp;thumbnailEventCamera: ${aa.thumbnailEventCamera}<br>
                &nbsp;thumbnailRatio: ${aa.thumbnailRatio}<br>
                &nbsp;title: ${aa.title}<br>
                &nbsp;update: ${aa.update}<br>
                &nbsp;version: ${aa.version}<br>
                <br>
            }`;
            $(".modal-json").html(html2);
            num2 = aa.id;
            $(".qrcode2").qrcode({
                id:"qr",
                render: "canvas",
                width: 100,
                height: 100,
                text: (link)

            });
        })
        .on("click", ".json" , function(){
            if(!$(".modal-json").hasClass("json-chk")){

                $(".modal-json").show();
                $(".modal-json").addClass("json-chk")
            }else {
                $(".modal-json").hide();
                $(".modal-json").removeClass("json-chk")
            }
        })
    })



var arr_cat = [];
var arr_tem = [];
// appendë¥¼ í•´ì£¼ëŠ” ë¶€ë¶„.(jQuery append with api call)
// ì•„ë˜ì˜ ë¶€ë¶„ì€ ê²°ê³¼ ì„±ê³µ call back í•¨ìˆ˜ì¸ë°, requestê°€ ì™„ë£Œë˜ì—ˆì„ ë•Œ, ì‹œì‘í•˜ëŠ” ë¶€ë¶„ì´ë‹¤.

function call_studio_api() {

    $.ajax({
        url: "/ajax/api/studio?appType=tianyan_real",
        success: function (result) {
            const r = result.result;
            arr_cat = r.categories;
            arr_tem = r.templates;
            html = '';
            num = 0;
            r.templates.forEach(e => {
                console.log(e)
                html += `
                <li class="box box${e.id}" data-id="${num}">
                    <h3 class="m_ckh" data-toggle="modal" data-target="#exampleModal">${e.id}</h3>
                    <div class="list_box m_ckh" data-toggle="modal" data-target="#exampleModal">
                        <img src="http://static.tianyancam.com/template/${e.id}/${e.thumbnail}" alt="">
                        <h3>${e.title}</h3>
                    </div>
                </li>
                `
                num+=1
            });

            $(".list").html(html);
        },
        error: function (e) {
        }
    })
}

function menu() {
    $.ajax({
        url: "/ajax/api/studio?appType=tianyan_real",
        success: function (result) {
            const r = result.result;
            console.log(r);
            html = '';

            let menu_data = [];
            r.categories.forEach(e => {

                if(menu_data.indexOf(e.title) == -1){
                    menu_data.push(e.title);
                    console.log(menu_data);
                }

            });
            for (let i = 0; i < menu_data.length; i++) {

                html += `
                    <li>${menu_data[i]}</li>
                `
            }
            $(".menu").html(html);
        },
        error: function (e) {
            console.log("err")
        }
    })
    console.log("on")
}

$(function () {
    menu();
    console.log("wda");
})

</script>